# ğŸš§ StateForge

> ğŸ“Œ ì•„ì§ ì™„ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë§Œë“¤ì–´ ë³´ê³  ìˆëŠ” ì¤‘ì…ë‹ˆë‹¤!

**StateForge**ëŠ” TypeScript ê¸°ë°˜ì˜ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, Reduxì˜ í•µì‹¬ ê°œë…ì„ ìœ ì§€í•˜ë©´ì„œ íƒ€ì… ì•ˆì „ì„±ê³¼ ê°œë°œì ê²½í—˜ì„ ìµœì í™”í•˜ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ìƒíƒœ ê´€ë¦¬ë¥¼ ê°„ì†Œí™”í•˜ê³ , íƒ€ì… ì¶”ë¡ ì„ í™œìš©í•˜ì—¬ ê°œë°œìê°€ ì§ë©´í•  ìˆ˜ ìˆëŠ” ë³µì¡ì„±ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤. ëª©í‘œëŠ” ì½”ë“œì˜ ì¼ê´€ì„±ì„ ë†’ì´ê³ , íŒ€ ë‚´ í‘œì¤€í™”ë¥¼ ì´‰ì§„í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•
- íƒ€ì… ì•ˆì „ì„± ê°•í™”: TypeScriptë¥¼ í™œìš©í•˜ì—¬ ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ê³¼ ì •í™•ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.
- ìë™ íƒ€ì… ì¶”ë¡ : ë³µì¡í•œ íƒ€ì… ì •ì˜ ì—†ì´ ìµœëŒ€í•œ ìë™ ì¶”ë¡ ì„ í™œìš©í•˜ì—¬ ê°œë°œìì˜ ë¶€ë‹´ì„ ì¤„ì…ë‹ˆë‹¤.
- ê°„ê²°í•˜ê³  ëª…í™•í•œ API: Reduxì˜ ê¸°ë³¸ ì›ì¹™ì„ ìœ ì§€í•˜ë©´ì„œ, ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ APIë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- ì½”ë“œ ì¼ê´€ì„± ë° í‘œì¤€í™”: í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ì¼ê´€ëœ ì½”ë“œ ìŠ¤íƒ€ì¼ê³¼ êµ¬ì¡°ë¥¼ ì´‰ì§„í•©ë‹ˆë‹¤.

> - ì§„ì§œ ì‰½ê³  í˜‘ì—…ì„ ìœ„í•œ ìƒíƒœê´€ë¦¬ë¥¼ ë§Œë“¤ì–´ë³´ì.
> - ê·¸ë™ì•ˆì€ ë„ˆë¬´ ììœ ì™€ ë°©ì¢…ì„ ì¶”êµ¬í–ˆë‹¤.
> - ê°•ë ¥í•œ ì œí•œ, ì´ë ‡ê²Œ ë°–ì— ì“¸ ìˆ˜ ì—†ëŠ” êµ¬ì¡°, ë°©ì‹!
> - ë””ë²„ê¹…, ìë™ì™„ì„±, íƒ€ì…ì²´í‚¹ ìš°ì„ 
> - ê·¸ëŸ¼ì—ë„ ì™¸ë¶€ ëª¨ë“ˆ ì˜ì¡´ë„ X

## íŠ¹ì§•

### ê°•ë ¥í•œ íƒ€ì… ì‹œìŠ¤í…œê³¼ ìë™ì™„ì„±
- StateForgeëŠ” TypeScriptì˜ ê°•ë ¥í•œ íƒ€ì… ì‹œìŠ¤í…œì„ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ëŠ” ê°œë°œ ì¤‘ì— ë†’ì€ ìˆ˜ì¤€ì˜ ìë™ì™„ì„± ì§€ì›ì„ ì œê³µí•˜ë©°, íƒ€ì… ê´€ë ¨ ì˜¤ë¥˜ë¥¼ ì‚¬ì „ì— ë°©ì§€í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ê°œë°œìê°€ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ í•„ìš”í•œ ì†ì„±ì´ë‚˜ ì•¡ì…˜ì„ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.

### ìµœì†Œí•œì˜ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸
- Reduxì™€ ê°™ì€ ê¸°ì¡´ì˜ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ ë§ì€ ì„¤ì •ê³¼ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤. StateForgeëŠ” ì´ëŸ° ë¶€ë¶„ì„ ëŒ€í­ ê°„ì†Œí™”í•˜ì—¬ ê°œë°œìê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë” ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. í•„ìš”í•œ ê¸°ëŠ¥ì„ ëª‡ ì¤„ì˜ ì½”ë“œë¡œ ê°„ê²°í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‚¬ì „ êµ¬ì„±ëœ í•„ìˆ˜ ìš”ì†Œë“¤
- StateForgeëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹ ë¥´ê²Œ ì‹œì‘í•  ìˆ˜ ìˆë„ë¡ ì‚¬ì „ì— í•„ìš”í•œ ë§ì€ êµ¬ì„± ìš”ì†Œë“¤ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œìëŠ” ë°˜ë³µì ì¸ ì„¤ì • ì‘ì—… ì—†ì´ ë°”ë¡œ ìƒíƒœ ê´€ë¦¬ ë¡œì§ì˜ êµ¬í˜„ì— ì°©ìˆ˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì°¨ë³„í™” ìš”ì†Œ

### Redux Toolkit ì˜ê°
- StateForgeëŠ” Redux Toolkitì˜ ì˜ê°ì„ ë°›ì•„ ë” ë‚˜ì€ ê°œë°œ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ StateForgeëŠ” íƒ€ì… ì•ˆì „ì„±ê³¼ ìë™ì™„ì„±ì„ ê°œì„ í•˜ì—¬ Redux Toolkitì´ ì œê³µí•˜ëŠ” ê²ƒ ì´ìƒì˜ ê°œë°œì ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.

### ì§ê´€ì ì¸ API
- StateForgeì˜ APIëŠ” ì§ê´€ì ì´ë©° ì‚¬ìš©í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤. ìŠ¬ë¼ì´ìŠ¤ ìƒì„±, ì•¡ì…˜ ì •ì˜, ìŠ¤í† ì–´ êµ¬ì„± ë“±ì˜ ê³¼ì •ì´ ë‹¨ìˆœí™”ë˜ì–´ ìˆì–´, ìƒˆë¡œìš´ ê°œë°œìë„ ì‰½ê²Œ ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œì„ ì´í•´í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### State & Action

- Interfaceë¥¼ ë¨¼ì € ì„¤ê³„í•˜ê³  ê°œë°œí•˜ëŠ” ë°©ì‹
- Stateì™€ Actionì„ ë¶„ë¦¬í•´ì„œ ê°œë°œí•˜ê¸° ì‰½ê²Œ! BDD, SDD
- ì“¸ë°ì—†ì€ ActionType, ActionCreator ì´ëŸ°ê±° NoNo!

```ts
export interface Todo {
  id:number
  text:string
  completed:boolean
}

export type VisibilityFilter = "SHOW_ALL"|"SHOW_COMPLETED"|"SHOW_ACTIVE"

interface Query {
  filteredTodos:Array<Todo>
}

export interface TodoState {
  todos:Array<Todo>
  items:Collection<Todo>
  visibilityFilter:VisibilityFilter
  Query: Query
}

export interface TodoActions {
  ADD_TODO(text:string):void
  TOGGLE_TODO(id:number):void
  REMOVE_TODO(id:number):void

  SET_VISIBILITY_FILTER(filter:VisibilityFilter):void
}
```

```ts
import {createStateForge} from "stateForge"

export const {
  createSlice,
  createEffect,
  createStore
} = createStateForge<TodoState, TodoActions>("store")
```


### Slice
- ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëª¨ë“ˆí™”
- Stateì™€ Actionì˜ ìë™ì™„ì„±
- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”ì—†ê²Œ ë‚´ì¥

```ts
import {createSlice} from "./index"

export const todos = createSlice(store => store.todos, [], helpers => {

  const {on, value, set, insert, remove, toggle} = helpers
  
  on.ADD_TODO((text) => {
    const newTodo = {id: Date.now(), text, completed: false}
    insert(newTodo)
  })

  on.TOGGLE_TODO((id) => {
    toggle(todo => todo.id === id, "completed")
  })

  on.REMOVE_TODO((id) => {
    remove(todo => todo.id === id)
  })
})

export const visibilityFilter = createSlice(store => store.visibilityFilter, "SHOW_ALL", ({on, set}) => {
  on.SET_VISIBILITY_FILTER(set)
})
```



### Store

- ê°•ë ¥í•œ ì¤‘ì•™ì§‘ê¶Œ
- ì°¾ì•„ê°€ê¸° ì‰½ê²Œ ë„¤ë¹„ê²Œì´ì…˜ì˜ ì—­í• , ì¶”í›„ ë””ë²„ê¹… ìš©ì´
- strict íƒ€ì…ì²´í‚¹, ë¹ ì§„ sliceê°€ ìˆìœ¼ë©´ íƒ€ì…ì—ëŸ¬

```ts
import {todos} from "./todos"
import {createStore} from "./index"
import {items, visibilityFilter} from "./etc.ts"

export const store = createStore({
  todos,
  items,
  visibilityFilter,
  section: {
    filteredTodos: []
  }
})
```


### Create API

```ts
type Response<T> = createResponse<{
  status:number,
  data:T
}>

interface API_Post {
  GET:{
    ["/posts/recommend"]():Response<{lastKey:string, list:Post[]}>
    ["/posts/:postId"](postId:string):Response<Post>
    ["/posts/:postId/comments"](postId:string, params?:unknown):Response<Comment[]>
  }
}

interface API_Calendar {
  GET:{
    ["/calendars"]():Response<Calendar[]>
    ["/calendars/:calendarId"](calendarId:string):Response<Calendar>
  }

  POST:{
    ["/calendars/:calendarId"](calendarId:string, body:Calendar, q:{lastKey:string}):Response<Calendar>
  }

  PUT:{
    ["/calendars/:calendarId"]():Response<Calendar>
  }
}

type API
  = API_Post
  & API_Calendar

export const api = createAPI<API>({
  baseURL: "https://uc-api.ep.oror.io/api",
  fetchOptions: {}
})
```

### API ì‚¬ìš©ë°©ë²•

```ts
const res = await api.GET["/posts/recommend"]()
console.log(res.data.data.list)

// pahh, queryString
const res2 = await api.GET["/posts/:postId"]("7yKG9ccNK82", {lastKey:100})
console.log(res2)

// path, body, queryString
const res3 = await api.POST["/calendars/:calendarId"]("!23123", {x:100}, {lastKey:100})
```

## ìƒê°í•´ë³´ê¸°.. ë©”ëª¨.. ì¸ì‚¬ì´íŠ¸..

---

```ts
on.ADD_TODO((text) => {

    // @TODO: anti-pattern
    // 1. ì™¸ë¶€ ê°’ì„ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ê²Œ í•˜ê¸°
    const account = state.account
    const todo = {id:guid(), title:text, userId: account.id} 
```


```ts
// ë¦¬ë•ìŠ¤ëŠ” ë¦¬ë“€ì„œë¥¼ ìˆœìˆ˜í•˜ê²Œ ë§Œë“¤ì–´ì•¼ í•œë‹¤!

createSlice(... => {
// 1. ì™¸ë¶€ ê°’ì´ í•„ìš”í•˜ë©´ payloadì— ë„£ì–´ë¼.
  on.ADD_TODO((text, account) => {
    const todo = {id: guid(), title: text, userId: account.id}
    //..
  })
})


// ë¦¬ë•ìŠ¤ëŠ” ì´ë ‡ê²Œ í•˜ë˜ë°.. ê²€í† í•´ë³´ê¸°...
const accountMiddleware = createMiddleware( ... => {
  // 2. accountë¥¼ ë§¤ë²ˆ ë„£ì–´ì£¼ëŠ”ê²Œ ë¶€ë‹´ìŠ¤ëŸ½ë‹¤ë©´ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ë¼!
  on.ADD_TODO(text, (dispatch) => {
    const account = state.account
    dispatch.ADD_TODO(text, account)
  })
})

```

